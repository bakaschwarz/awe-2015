.panel-group#maindiagram-panels
-main_diagram_hash = ordered_timestamps_for_main_diagram({from: filter_from.to_i, to: filter_to.to_i})
-main_diagram_hash.each_pair do |main_diagram, time_stamp_hash|
  -@main_diagram = main_diagram # set it to an instance variable in order to access it from javascript in other file
  -@time_stamp_hash = time_stamp_hash
  %div.panel.panel-default
    %div.panel-heading.panel-header.main-diagram
      %div{id: "main_diagram_label", style: "cursor: pointer;"}
        %h2= main_diagram.label
      #main_diagram_content
        =render 'main_diagram_chart'
        .main-diagram-selection-container
          %h3= "Select sensors to display"
          -# Thanks to: http://stackoverflow.com/questions/15696415/html-multiple-select-box
          %section.md-container
            .md-left
              .md-label Shown
              %select#leftValues{size: @sensors.count+1, multiple: true}
                -@sensors.each do |sensor|
                  -if sensor.main_diagram == @main_diagram
                    %option= sensor.label + ", " + sensor.station.label
            .md-middle
              .md-label
              %input#btnLeft{type: "button", value: "<<"}
              %input#btnRight{type: "button", value: ">>"}
              .btn.btn-primary.md-btn#update-md= "Update diagram"
              .btn.btn-primary.md-btn#save-md-config= "Save configuration"
            .md-right
              .md-label Now shown
              %select#rightValues{size: @sensors.count, multiple: true}
                -@sensors.each do |sensor|
                  -if sensor.main_diagram != @main_diagram
                    %option= sensor.label + ", " + sensor.station.label
              %div
                %input#txtRight{type: "text"}
:javascript
  $("#btnLeft").click(function () {
      var selectedItem = $("#rightValues option:selected");
      $("#leftValues").append(selectedItem);
  });

  $("#btnRight").click(function () {
      var selectedItem = $("#leftValues option:selected");
      $("#rightValues").append(selectedItem);
  });

  $("#rightValues").change(function () {
      var selectedItem = $("#rightValues option:selected");
      $("#txtRight").val(selectedItem.text());
  });

  $("#save-md-config").click(function () {
      alert("hi");
  });

%hr
.panel-group#station-panels
  -station_hash = ordered_timestamps_for_stations({from: filter_from.to_i, to: filter_to.to_i})
  -station_hash_sorted = Hash[station_hash.sort_by {|station, time_stamp_hash| station[:dashboard_position]}]
  -station_hash_sorted.each_pair do |station, time_stamp_hash|
    -@station = station
    -@time_stamp_hash = time_stamp_hash
    -# Make the stations collapsible
    = render 'collapsejs'
    %div.panel.panel-default.station{ station_id: station.id, dashboard_position: station.dashboard_position}
      %div.panel-heading.panel-header
        %div{id: "station_#{station.id}", style: "cursor: pointer;"}
          %h2= station.label
        %div{id: "station_content_#{station.id}"}
          =render 'sensor_charts'
          %div.panel.panel-default
            %div.panel-heading.panel-header
              %div{id: "station_table_toggle_#{station.id}", style: "cursor: pointer;"}
                %h3{id: "station_table_label_#{station.id}"} Show table
            %table.table.table-striped.table-bordered{id: "station_table_#{station.id}"}
              %tr
                %th= "Time Stamp"
                -station.sensors.each do |sensor|
                  %th
                    = sensor.label
                    = "["
                    = sensor.unit
                    = "]"
              -time_stamp_hash.each_pair do |time_stamp, value_hash|
                %tr
                  %td= Time.at(time_stamp).to_formatted_s(:db)
                  -station.sensors.each do |sensor|
                    %td
                      -if value_hash[sensor.id] == nil
                        = "N/A"
                      -else
                        = value_hash[sensor.id]